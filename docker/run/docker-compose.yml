services:
  agent-zero:
    image: agent0ai/agent-zero:latest
    ports:
      - "50080:8080"
    # drop most capabilities for safety
    cap_drop:
      - ALL
    environment:
      DOCKER_HOST: tcp://dind:2375     # point it at the sidecar
    depends_on:
      - dind

  dind:
    image: docker:25.0-dind
    privileged: true
    command: |
      dockerd \
        --host=tcp://0.0.0.0:2375 \
        --storage-driver=overlay2 \
        --storage-opt dm.basesize=20G \
        --data-root=/var/lib/docker
    expose:
      - "2375"
    volumes:
      - agentzero-build-cache:/var/lib/docker

volumes:
  agentzero-build-cache:
