services:
  agent-zero:
    image: agent0ai/agent-zero:latest
    user: "0:0"                  # run as root *inside* the container
    security_opt:
      - no-new-privileges:false
    ports:
      - "50080:80"
    # drop most capabilities for safety
    restart: unless-stopped
    cap_drop:
      - ALL
    environment:
      DOCKER_HOST: tcp://dind:2375     # point it at the sidecar
    depends_on:
      - dind

  dind:
    image: docker:25.0-dind
    privileged: true
    expose:
      - "2375"
    volumes:
      - agentzero-build-cache:/var/lib/docker

volumes:
  agentzero-build-cache:
